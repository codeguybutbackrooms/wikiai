<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WikiAI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: Georgia, "Times New Roman", serif;
      background: #ffffff;
      color: #202122;
      margin: 0;
      padding: 0;
    }

    header {
      background: #f8f9fa;
      border-bottom: 1px solid #a2a9b1;
      padding: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    header .logo {
      font-weight: bold;
      font-size: 20px;
      display: flex;
      align-items: center;
    }

    header .logo .square {
      width: 24px;
      height: 24px;
      background: #ffffff;
      color: #000000;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 8px;
      font-weight: bold;
    }

    header input {
      padding: 5px;
      width: 250px;
    }

    header button {
      padding: 6px 10px;
      margin-left: 5px;
      border: 1px solid #a2a9b1;
      background: #f8f9fa;
      cursor: pointer;
    }

    main {
      max-width: 900px;
      margin: 20px auto;
      padding: 0 15px;
      line-height: 1.6;
    }

    h1 {
      font-size: 1.8em;
      border-bottom: 1px solid #a2a9b1;
      padding-bottom: 5px;
      margin-top: 1em;
    }

    h2 {
      font-size: 1.5em;
      border-bottom: 1px solid #cccccc;
      margin-top: 1.2em;
    }

    h3 {
      font-size: 1.2em;
      margin-top: 1em;
    }

    a {
      color: #0645ad;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    ul {
      margin-left: 2em;
    }
    
    .languages a { cursor: pointer; color: #0645ad; text-decoration: none; padding: 0 4px; }
    .languages a.active { font-weight: 700; text-decoration: underline; }

    #content {
      margin-top: 20px;
    }

    .recommend {
      background: #f8f9fa;
      border: 1px solid #a2a9b1;
      padding: 10px;
      margin-top: 20px;
    }

    .recommend h2 {
      margin-top: 0;
      border-bottom: none;
    }

    .small {
      font-size: 0.9em;
      color: #54595d;
    }

    @media (min-width: 600px) {
      header {
      flex-wrap: nowrap;
    }
    header .logo {
      margin-bottom: 0;
    }
    header div {
      width: auto;
      flex-wrap: nowrap;
    }
    header input {
      width: 250px;
      margin-bottom: 0;
    }
    header button {
      flex: none;
      margin-bottom: 0;
    }
  }

  </style>
</head>
<body>
  <header>
    <div class="logo">
      <div class="square">W</div>
      WikiAI
    </div>
    <nav class="languages">
      <a href="#/en" data-lang="en" onclick="setLanguage('en'); return false;">en</a> |
      <a href="#/vi" data-lang="vi" onclick="setLanguage('vi'); return false;">vi</a> |
      <a href="#/ru" data-lang="ru" onclick="setLanguage('ru'); return false;">ru</a> |
      <a href="#/fr" data-lang="fr" onclick="setLanguage('fr'); return false;">fr</a> |
      <a href="#/de" data-lang="de" onclick="setLanguage('de'); return false;">de</a>
    </nav>

    <div>
      <input type="text" id="searchInput" placeholder="Search WikiAI...">
      <button onclick="searchTopic()">Search</button>
      <button onclick="loadRandom()">Random</button>
    </div>
  </header>

  <main>
    <div id="content">
      <h1>Welcome to WikiAI</h1>
      <p>
        WikiAI is an experimental encyclopedia where every article is written on demand by artificial intelligence. 
        You can search for any topic, or explore some recommended pages to get started.
      </p>

      <div class="recommend">
        <h2>Recommended Pages</h2>
        <ul>
          <li><a href="#" onclick="generatePage('Artificial Intelligence')">Artificial Intelligence</a></li>
          <li><a href="#" onclick="generatePage('History of Space Exploration')">History of Space Exploration</a></li>
          <li><a href="#" onclick="generatePage('Ancient Egypt')">Ancient Egypt</a></li>
          <li><a href="#" onclick="generatePage('Quantum Mechanics')">Quantum Mechanics</a></li>
          <li><a href="#" onclick="generatePage('Shakespeare')">Shakespeare</a></li>
        </ul>
      </div>

      <p class="small">Note: All pages outside this main page are AI-generated using the Gemini API.</p>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <script>
  const API_KEY = "YOUR_GEMINI_API_KEY";
  const SUPPORTED_LANGS = ['en','vi','ru','fr','de'];

  let language = 'en';
  let currentTopic = null;

  // font mapping
  const FONT_MAP = {
    en: "'Roboto', Arial, sans-serif",
    vi: "'Noto Sans', sans-serif",
    fr: "'Roboto', Arial, sans-serif",
    de: "'Roboto', Arial, sans-serif",
    ru: "'Noto Serif', Georgia, serif"
  };

  // -- helpers
  function slugify(s) {
    return encodeURIComponent(String(s).trim().replace(/\s+/g, '-'));
  }
  function unslug(slug) {
    return decodeURIComponent(slug).replace(/-/g, ' ');
  }

  // highlight fonts
  function updateLanguageUI() {
    document.querySelectorAll('.languages a').forEach(a => {
      a.classList.toggle('active', a.dataset.lang === language);
    });
    updateFont();
  }

  // update font based on language
  function updateFont() {
    const font = FONT_MAP[language] || "sans-serif";
    document.body.style.fontFamily = font;
  }

  // parse hash like "#/vi/The-Topic-Name" -> {lang, topic}
  function parseHash() {
    const hash = (location.hash || '#/en').replace(/^#/, '');
    const parts = hash.split('/').filter(Boolean);
    let lang = parts[0] || 'en';
    if (!SUPPORTED_LANGS.includes(lang)) lang = 'en';
    const topic = parts.length > 1 ? unslug(parts.slice(1).join('/')) : null;
    return { lang, topic };
  }

  // apply state when hash changes or on load
  function applyStateFromHash() {
    const { lang, topic } = parseHash();
    language = lang;
    updateLanguageUI();
    if (topic) {
      generatePage(topic, false);
    } else {
      showHome();
    }
  }

  // show main page
  function showHome() {
    currentTopic = null;
    const contentDiv = document.getElementById("content");
    contentDiv.innerHTML = `
      <h1>Welcome to WikiAI</h1>
      <p>
        WikiAI is an experimental encyclopedia where every article is written on demand by artificial intelligence. 
        You can search for any topic, or explore some recommended pages to get started.
      </p>
      <div class="recommend">
        <h2>Recommended Pages</h2>
        <ul>
          <li><a href="#/en/Artificial-Intelligence" onclick="generatePage('Artificial Intelligence'); return false;">Artificial Intelligence</a></li>
          <li><a href="#/en/History-of-Space-Exploration" onclick="generatePage('History of Space Exploration'); return false;">History of Space Exploration</a></li>
          <li><a href="#/en/Ancient-Egypt" onclick="generatePage('Ancient Egypt'); return false;">Ancient Egypt</a></li>
          <li><a href="#/en/Quantum-Mechanics" onclick="generatePage('Quantum Mechanics'); return false;">Quantum Mechanics</a></li>
          <li><a href="#/en/Shakespeare" onclick="generatePage('Shakespeare'); return false;">Shakespeare</a></li>
        </ul>
      </div>
      <p class="small">Note: All pages outside this main page are AI-generated using the Gemini API.</p>
    `;
  }

  // set language
  function setLanguage(lang) {
    if (!SUPPORTED_LANGS.includes(lang)) lang = 'en';
    language = lang;
    updateLanguageUI();
    const newHash = currentTopic ? `#/${language}/${slugify(currentTopic)}` : `#/${language}`;
    location.hash = newHash;
  }

  // generate page
  async function generatePage(topic, pushHash = true) {
    currentTopic = topic;
    const contentDiv = document.getElementById("content");
    contentDiv.innerHTML = `<h1>${escapeHtml(topic)}</h1><p class="small">Loading article in ${language}...</p>`;

    if (pushHash) {
      location.hash = `#/${language}/${slugify(topic)}`;
    }

    try {
      const resp = await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=" + API_KEY, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          contents: [
            {
              parts: [
                {
                  text: `Create a well-researched, detailed Wikipedia-like article about ${topic}. The language is ${language}. Ensure the page is super good and interesting by using h2 and h3 headings for a clear structure. Use bold and italic text to highlight key information and use bullet points to present lists and key facts.`
                }
              ]
            }
          ]
        })
      });
      const data = await resp.json();
      const text = data.candidates?.[0]?.content?.parts?.[0]?.text || "(No content returned)";
      document.getElementById("content").innerHTML = `<h1>${escapeHtml(topic)}</h1>` + marked.parse(text);
    } catch (err) {
      contentDiv.innerHTML = `<h1>${escapeHtml(topic)}</h1><p>Error loading content: ${escapeHtml(String(err))}</p>`;
    }
  }

  // escape HTML
  function escapeHtml(s) {
    return String(s).replace(/[&<>"']/g, function (m) {
      return ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'})[m];
    });
  }

  // init
  window.addEventListener('hashchange', applyStateFromHash);
  window.addEventListener('load', () => {
    if (!location.hash) location.hash = '#/en';
    applyStateFromHash();
    document.getElementById("searchInput").addEventListener("keydown", function(e) {
      if (e.key === "Enter") {
        searchTopic();
      }
    });
  });

  // search
  function searchTopic() {
    const q = document.getElementById("searchInput").value.trim();
    if (q) generatePage(q);
  }

  // random loader
  function loadRandom() {
    const topics = ["The History of the Internet","The Science of Black Holes","The Life and Works of Leonardo da Vinci","The Roman Empire","The Principles of Quantum Computing","The Discovery of DNA","The Formation of the Himalayas","The Art of Japanese Calligraphy","The Causes and Effects of Climate Change","The Mythology of Ancient Egypt","The Rise and Fall of the Berlin Wall","The Psychology of Dreams","The History of Coffee","The Evolution of Human Language","The Great Barrier Reef: Biodiversity and Threats","The Science of Sleep","The Apollo 11 Mission to the Moon","The Philosophy of Existentialism","The Development of Artificial Intelligence","The Vikings: Seafarers and Raiders","The Invention of the Printing Press","The Geology of Volcanoes","The History of the Samurai","The Neuroscience of Music","The Silk Road: Trade and Culture","The Physics of Superconductors","The Story of the Taj Mahal","The Principles of Renewable Energy","The History of Jazz Music","The Exploration of Mars","The Human Genome Project","The Byzantine Empire","The Biology of Coral Reefs","The History of the World Wide Web","The Life and Legacy of Marie Curie","The Science of Tides","The Rise of Silicon Valley","The Chemistry of Cooking","The Roman Colosseum","The Science of Earthquakes","The Renaissance in Europe","The Psychology of Memory","The History of Cryptography","The Life and Ideas of Albert Einstein","The Ecosystems of the Amazon Rainforest","The Evolution of Money","The Discovery of Penicillin","The Physics of Light","The History of Anime and Manga","The Architecture of Frank Lloyd Wright"];
    const choice = topics[Math.floor(Math.random() * topics.length)];
    generatePage(choice);
  }
  </script>

